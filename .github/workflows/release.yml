name: ğŸš€ Build & Release Matches Integration (90minut)

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Podaj numer wersji (np. 0.1.003-alpha)'
        required: true

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ§© Checkout repo
        uses: actions/checkout@v4

      - name: ğŸ§° Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: 3.x

      - name: ğŸ” Wczytaj wersjÄ™ z inputu
        id: version
        run: |
          VERSION="${{ github.event.inputs.version }}"
          echo "VERSION=${VERSION}" >> $GITHUB_ENV
          echo "ğŸ”– Version: ${VERSION}"

      - name: ğŸ“ Zaktualizuj manifest.json i README.md
        run: |
          echo "AktualizujÄ™ wersjÄ™ w manifest.json i README.md..."
          sed -i "s/\"version\": \".*\"/\"version\": \"${VERSION}\"/g" custom_components/matches_90minut/manifest.json
          sed -i "s/Version:.*/Version: ${VERSION}/g" README.md || true

      - name: ğŸ—œï¸ Zbuduj paczkÄ™ ZIP (bez dodatkowego folderu)
        run: |
          mkdir dist
          zip -r "dist/matches_90minut-${VERSION}.zip" custom_components README.md hacs.json -x "*.git*" -x "*/__pycache__/*"

      - name: ğŸ·ï¸ UtwÃ³rz tag i release
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ env.VERSION }}
          name: Matches Integration (90minut) ${{ env.VERSION }}
          body: |
            Automatyczny release wersji **${{ env.VERSION }}**

            ğŸ§© Integracja: Matches Integration (90minut)
            ğŸ“¦ ZawartoÅ›Ä‡: custom_components/, README.md, hacs.json
          draft: false
          prerelease: false
          files: dist/*.zip
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
