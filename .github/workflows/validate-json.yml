name: ğŸ§© Validate JSON & Version Consistency

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    name: Validate JSON files and manifest version

    steps:
      - name: ğŸ§© Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ§° Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: 3.x

      # ğŸ”¹ Walidacja plikÃ³w JSON
      - name: ğŸ” Validate JSON files
        run: |
          echo "Sprawdzam poprawnoÅ›Ä‡ plikÃ³w JSON..."
          python -m json.tool hacs.json > /dev/null
          python -m json.tool custom_components/matches_90minut/manifest.json > /dev/null
          for f in custom_components/matches_90minut/translations/*.json; do
            python -m json.tool "$f" > /dev/null
          done
          echo "âœ… Wszystkie pliki JSON sÄ… poprawne!"

      # ğŸ”¹ Sprawdzenie zgodnoÅ›ci wersji manifestu z ostatnim tagiem
      - name: ğŸ·ï¸ Check manifest version against latest Git tag
        run: |
          echo "Sprawdzam zgodnoÅ›Ä‡ wersji w manifest.json z tagiem GitHub..."
          # pobierz wersjÄ™ z manifest.json
          MANIFEST_VERSION=$(python3 -c "import json; print(json.load(open('custom_components/matches_90minut/manifest.json'))['version'])")
          echo "ğŸ“¦ Wersja w manifest.json: ${MANIFEST_VERSION}"

          # pobierz najnowszy tag z repozytorium
          git fetch --tags
